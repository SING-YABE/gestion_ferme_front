<div>
  <div style="margin-top: -10px; margin-left: -30px;  margin-right: -30px; background-color: #f16e00" class="flex mb-3 gap-3 pl-3 pr-3 pb-2 align-items-center h-10rem" >
    <div style="margin-top: -35px" class="flex-1 pl-3">
      <h4 class="text-white">{{projectId}} > Dépenses effectuées sur le projet</h4>
    </div>

 <!--    <button pButton class="p-button-white p-button-rounded no-print" icon="pi pi-file-excel" label="Exporter" (click)="exportToExcel()"></button>-->

    <div style="margin-top: -40px">
      <app-budget-form (onDone)="loadData()"></app-budget-form>
    </div>
  </div>

  <div style="margin-top: -95px" class="odyssey-shadow-low border-round">

    <div class="">
      <p-table [loading]="loading" [value]="budgets" [rows]="20" [paginator]="true">
        <ng-template pTemplate="header">
          <tr class="bg-white">
            <th style="font-size:16px; font-weight: bold" pSortableColumn="type">Ligne budgétaire <p-sortIcon field="type"></p-sortIcon></th>
            <th style="font-size:16px; font-weight: bold" pSortableColumn="dateDepense">Date dépense <p-sortIcon field="dateDepense"></p-sortIcon></th>
            <th style="font-size:16px; font-weight: bold" pSortableColumn="label">Libellé dépense <p-sortIcon field="label"></p-sortIcon></th>
            <th style="font-size:16px; font-weight: bold" pSortableColumn="amount">Montant <p-sortIcon field="amount"></p-sortIcon></th>
            <th style="font-size:16px; font-weight: bold" >Actions</th>
          </tr>

        </ng-template>
        <ng-template pTemplate="body" let-budget>
          <tr>
            <td>
              <p class="mb-1">{{ budget?.annualBudgetDTO.label }}</p>
              <p-tag [severity]="budget.type == 'CAPEX' ? 'contrast' : 'contrast'" [value]="budget.annualBudgetDTO.type +'-'+ budget.projectDTO.directionName"></p-tag>
            </td>
            <td>
              <span> {{ budget.dateDepense | date:'dd/MM/YYYY' }} </span>
            </td>
            <td>
              <span> {{ budget.label }} </span>
            </td>
            <td>
              <span class="font-bold">{{ budget.amount | number: '':'fr' }} XOF</span>
            </td>
            <td>
              <div class="flex align-content-end gap-2 align-items-center">
                <app-budget-form (onDone)="loadData()" mode="edit" [target]="budget"></app-budget-form>
                <button (click)="showBudgetDetails(budget)" class="p-button-rounded " pButton icon="pi pi-eye"></button>
                <button (click)="handleDelete(budget)" class="p-button-rounded p-button-danger" pButton icon="pi pi-trash"></button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>

</div>

<!-- Modale détails du budget -->
<p-dialog [(visible)]="showDetailsModal" [modal]="true" [dismissableMask]="true" [style]="{width: '600px'}">
  <ng-template pTemplate="header">
    <h4 class="m-0">Détails de la dépense</h4>
  </ng-template>

  <div class="pt-2">
    <div class="field"><label>Ligne Budgetaire:</label><p>{{ selectedBudget?.annualBudgetDTO?.label }} ({{selectedBudget?.annualBudgetDTO?.type +"-"+ selectedBudget?.annualBudgetDTO?.direction?.name}})</p></div>
    <div class="field"><label>Date Dépense:</label><p>{{ selectedBudget?.dateDepense | date:'dd/MM/YYYY' }}</p></div>
    <div class="field"><label>Libellé Dépense:</label><p>{{ selectedBudget?.label }}</p></div>
    <div class="field"><label>Montant:</label><p class="font-bold">{{ selectedBudget?.amount | number: '':'fr' }} XOF</p></div>
    <div class="field"><label>Type:</label><p-tag [severity]="selectedBudget?.type == 'CAPEX' ? 'success' : 'warning'" [value]="selectedBudget?.annualBudgetDTO?.type"></p-tag></div>
    <div class="field"><label>Direction:</label><p>{{ selectedBudget?.direction?.name }}</p></div>
    <div class="field"><label>Description:</label><p>{{ selectedBudget?.description }}</p></div>
    <div *ngIf="selectedBudget?.actionPlans != null" class="field"><label>Plan d'action:</label><p>{{ selectedBudget?.actionPlans?.title }}</p></div>

  </div>

  <ng-template pTemplate="footer">
    <button (click)="showDetailsModal = false" pButton label="Fermer" icon="pi pi-times"></button>
  </ng-template>
</p-dialog>

<p-confirmDialog appendTo="body"></p-confirmDialog>

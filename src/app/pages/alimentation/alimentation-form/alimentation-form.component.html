<button *ngIf="mode === 'create'" pButton icon="pi pi-plus" label="Nouvelle alimentation"
        class="p-button-success"
        style="background:#2E7D32; border-color:#2E7D32;" (click)="handleShow()">
</button>

<p-dialog [(visible)]="showForm" [modal]="true" appendTo="body" header="Alimentation"
          [style]="{width: '750px'}" styleClass="farm-dialog">
  <form [formGroup]="form" id="alimentationForm" (ngSubmit)="handleSubmit()">

    <!-- Section Date et Type -->
    <fieldset style="border:1px solid #c8e6c9; padding:1rem; border-radius:8px; margin-bottom:1rem;">
      <legend style="font-weight:300; color:#2E7D32;">Informations principales</legend>
      <div class="grid formgrid">
        <div class="col-6">
          <div class="field">
            <label>Date d'entrée <span style="color: red;">*</span></label>
            <p-calendar formControlName="date" dateFormat="dd/mm/yy" [showIcon]="true" inputId="date"></p-calendar>
          </div>
        </div>
        <div class="col-6">
          <div class="field">
            <label>Type d'aliment <span style="color: red;">*</span></label>
            <p-dropdown formControlName="typeAlimentId" [options]="typeAliments"
                        optionLabel="libelle" optionValue="id"
                        placeholder="Sélectionner un type d'aliment" [filter]="true"></p-dropdown>
          </div>
        </div>
      </div>
    </fieldset>

    <!-- Section Mode -->
    <fieldset style="border:1px solid #c8e6c9; padding:1rem; border-radius:8px; margin-bottom:1rem;">
      <legend style="font-weight:300; color:#2E7D32;">Mode d'alimentation</legend>
      <div class="flex gap-3 mb-3">
        <button type="button" pButton label="Animal individuel"
                [class]="modeAlimentation === 'individuel' ? 'p-button-success' : 'p-button-outlined'"
                [style]="modeAlimentation === 'individuel' ? 'background:#2E7D32; border-color:#2E7D32;' : 'color:#2E7D32; border-color:#2E7D32;'"
                (click)="switchMode('individuel')"></button>

        <button type="button" pButton label="Alimentation par lot"
                [class]="modeAlimentation === 'lot' ? 'p-button-success' : 'p-button-outlined'"
                [style]="modeAlimentation === 'lot' ? 'background:#2E7D32; border-color:#2E7D32;' : 'color:#2E7D32; border-color:#2E7D32;'"
                (click)="switchMode('lot')"></button>
      </div>

      <div *ngIf="modeAlimentation === 'individuel'" class="field">
        <label>Code Animal</label>
        <p-dropdown formControlName="animalId" [options]="animaux" optionLabel="codeAnimal" optionValue="id"
                    placeholder="Sélectionner un animal" [filter]="true"></p-dropdown>
      </div>

      <div *ngIf="modeAlimentation === 'lot'" class="field">
        <label>Type d'animal (Lot)</label>
        <p-dropdown formControlName="typeAnimalId" [options]="typeAnimaux" optionLabel="nom" optionValue="id"
                    placeholder="Sélectionner un type d'animal" [filter]="true"></p-dropdown>
      </div>
    </fieldset>

    <!-- Section Quantité et Prix -->
    <fieldset style="border:1px solid #c8e6c9; padding:1rem; border-radius:8px; margin-bottom:1rem;">
      <legend style="font-weight:300; color:#2E7D32;">Quantité et Prix</legend>
      <div class="grid formgrid">
        <div class="col-6">
          <div class="field">
            <label>Quantité (Kg) <span style="color: red;">*</span></label>
            <input pInputText type="number" step="0.01" formControlName="quantiteKg" />
          </div>
        </div>
        <div class="col-6">
          <div class="field">
            <label>Prix unitaire (FCFA/Kg) <span style="color: red;">*</span></label>
            <input pInputText type="number" step="0.01" formControlName="prixUnitaire" />
          </div>
        </div>
      </div>
      <div class="field">
        <label>Fournisseur</label>
        <p-dropdown formControlName="fournisseurId" [options]="fournisseurs" optionLabel="nom" optionValue="id"
                    placeholder="Sélectionner un fournisseur (optionnel)" [filter]="true" [showClear]="true"></p-dropdown>
      </div>
    </fieldset>

    <!-- Coût total -->
    <div class="field" style="padding:1rem; border-radius:8px; background:#e8f5e9; border:1px solid #c8e6c9; margin-bottom:1rem;">
      <div class="flex justify-content-between align-items-center">
        <span style="font-weight:600; color:#1B5E20;">Coût total calculé :</span>
        <span style="font-size:1.25rem; font-weight:700; color:#2E7D32;">
          {{ coutTotal | number:'1.2-2' }} FCFA
        </span>
      </div>
    </div>

  </form>

  <!-- Footer -->
  <ng-template pTemplate="footer">
    <button pButton class="p-button-outlined mr-2" style="color:#2E7D32; border-color:#2E7D32;"
            (click)="showForm = false">
      Annuler
    </button>

    <button pButton class="p-button-success" form="alimentationForm" type="submit" [loading]="processing"
            [disabled]="!form.valid" style="background:#1B5E20; border-color:#1B5E20;">
      Enregistrer
    </button>
  </ng-template>
</p-dialog>

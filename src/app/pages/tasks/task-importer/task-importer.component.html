<button (click)="showUploadTasks = true" label="Importer des actions" class="p-button-sm" pButton></button>


<p-sidebar appendTo="body" position="right" [modal]="true" [(visible)]="showUploadTasks" [style]="{width: '100%'}">

  <ng-template pTemplate="header">
    <div class="flex-1">
      <h3 class="m-0">Importer des actions</h3>
    </div>
  </ng-template>

  <div class="pt-3">
    <div (click)="tasksUploader.click()" class="surface-100 cursor-pointer border-round justify-content-center align-items-center p-3 flex flex-column gap-2">
      <fa-icon size="3x" [icon]="faUpload"></fa-icon>
      <div>
        <h5 class="m-0 text-center">Cliquez pour charger un fichier</h5>
      </div>
      <input #tasksUploader type="file" hidden="hidden" (change)="handleFile($event)"/>
    </div>

    <button (click)="handleAddTask()" class="my-2 p-button-sm" pButton icon="pi pi-plus" label="Ajouter une action"></button>

    <table class="w-full">
      <thead>
        <tr class="bg-white">
          <th>Porteur</th>
          <th>Action</th>
          <th>Date de d√©but</th>
          <th>Date de fin</th>
          <th>Statut actuel</th>
          <th>Description</th>
        </tr>
      </thead>

      <tbody>
        @for (task of tasks; track $index){
          <tr>
            <td>
              <app-user-filter optionValue="cuid" optionLabel="displayname" [(ngModel)]="task.executorCuid"></app-user-filter>
            </td>
            <td>
              <input [(ngModel)]="task.title" class="w-full" pInputText/>
            </td>
            <td>
              <p-calendar dateFormat="dd/mm/yy" [(ngModel)]="task.startDate" class="w-full"></p-calendar>
            </td>
            <td>
              <p-calendar dateFormat="dd/mm/yy" [(ngModel)]="task.plannedEndDate" class="w-full"></p-calendar>
            </td>
            <td>
              <p-dropdown [(ngModel)]="task.status" [options]="statuses" optionLabel="label" optionValue="value" placeholder="Choisir un statut" class="w-full"></p-dropdown>
            </td>
            <td>
              <input [(ngModel)]="task.description" class="w-full" pInputText />
            </td>
          </tr>
        }
      </tbody>
    </table>

  </div>

  <ng-template pTemplate="footer">
    <div class="flex gap-2">
      <button (click)="showUploadTasks = false" class="p-button-danger p-button-outlined" icon="pi pi-times" label="Annuler" pButton></button>
      <button (click)="handleSaveTasks()" [loading]="processing" class="p-button-success" icon="pi pi-save" label="Enregistrer" pButton></button>
    </div>
  </ng-template>

</p-sidebar>

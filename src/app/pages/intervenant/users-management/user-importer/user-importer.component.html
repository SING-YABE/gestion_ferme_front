<button pButton (click)="handleShowForm()" icon="pi pi-plus" label="Nouveau utilisateur"></button>


<p-dialog appendTo="body" [modal]="true" [dismissableMask]="true" [style]="{width: '600px'}" [(visible)]="showForm">

  <ng-template pTemplate="header">
    <h4 class="m-0">Outils d'importation d'utilisateur</h4>
  </ng-template>

  <div class="pt-2">

    <div class="field">
      <input (input)="searchUser($event)" pInputText type="search" placeholder="Rechercher un utilisateur">
    </div>

    <div>
      <p-table [value]="users">
        <ng-template pTemplate="header">
          <tr>
            <th>Cuid</th>
            <th>Nom & Prénoms</th>
            <th> Action </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-user>
          <tr>
            <td>{{ user.cuid }}</td>
            <td class="font-bold">{{ user.displayname }}</td>
            <td>
              <button (click)="showImporterForm = true; toImport = user" class="p-button-outlined" pButton icon="pi pi-download"></button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </div>

  </div>

  <ng-template pTemplate="footer">
    <button [loading]="processing" (click)="showForm = false" pButton label="Fermer" class="p-button-danger"></button>
  </ng-template>


</p-dialog>



<p-dialog header="Importation" appendTo="body" [modal]="true" [style]="{width: '800px'}" [(visible)]="showImporterForm">

  <div *ngIf="toImport != undefined">
    <div class="flex gap-3">

      <div class="field">
        <label for="lastname">Nom</label>
        <input disabled [ngModel]="toImport.lastname" pInputText id="lastname" />
      </div>
      <div class="field">
        <label for="firstname">Prénom</label>
        <input disabled [ngModel]="toImport.firstname" pInputText id="firstname" />
      </div>
    </div>

    <div class="field">
      <label for="email">Email</label>
      <input [(ngModel)]="toImport.email" type="email" pInputText id="email" />
    </div>

    <div class="field">
      <label for="phone">Numéro de téléphone</label>
      <input [(ngModel)]="toImport.msisdn" pInputText id="phone" />
    </div>

    <div class="field">
      <label for="direction">Direction</label>
      <p-dropdown placeholder="Direction" [(ngModel)]="selectedDirection" (ngModelChange)="handleChange($event)" appendTo="body" [filter]="true" filterBy="name,description" [emptyMessage]="emptyMessage" id="direction" optionLabel="description" [options]="directions"></p-dropdown>
    </div>

    <div class="field">
      <label for="departement">Departement</label>
      <p-dropdown [(ngModel)]="selectedDepartmentId" placeholder="Département" [filter]="true" filterBy="name" appendTo="body" [emptyMessage]="emptyMessage" id="departement" optionLabel="name" optionValue="id" [options]="departments"></p-dropdown>
    </div>
    <div class="field">
      <label for="role">Role</label>
      <p-dropdown
        [(ngModel)]="selectedRoleId"
        placeholder="Role"
        [filter]="true"
        filterBy="name"
        appendTo="body"
        [emptyMessage]="emptyMessage"
        id="role"
        optionLabel="name"
        optionValue="code"
        [options]="roles">
      </p-dropdown>
    </div>


  </div>

  <ng-template pTemplate="footer">
    <button (click)="showImporterForm = false" pButton class="p-button-danger mr-2 p-button-outlined">Annuler</button>
    <button [loading]="processing" (click)="handleImport()" pButton>Enregistrer</button>
  </ng-template>

</p-dialog>
